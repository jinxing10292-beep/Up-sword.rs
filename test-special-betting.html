<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Betting Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-container { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .special-btn { padding: 10px 15px; margin: 5px; border: 2px solid #ccc; background: #f9f9f9; cursor: pointer; border-radius: 5px; }
        .special-btn.selected { background: #fbbf24; border-color: #fbbf24; color: #000; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        #errorMessage { background: #dc2626; color: white; padding: 10px 15px; border-radius: 8px; margin: 10px 0; font-weight: 600; text-align: center; border: 2px solid #b91c1c; display: none; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Special Betting Validation Test</h1>
    
    <div class="test-container">
        <h2>Interactive Test - Try selecting special bets</h2>
        <p>Current limit: <strong>2 special bets maximum</strong></p>
        
        <div id="errorMessage"></div>
        
        <div class="special-bets">
            <button class="special-btn" data-bet="red">ë¹¨ê°„ìƒ‰ (2ë°°)</button>
            <button class="special-btn" data-bet="black">ê²€ì€ìƒ‰ (2ë°°)</button>
            <button class="special-btn" data-bet="even">ì§ìˆ˜ (2ë°°)</button>
            <button class="special-btn" data-bet="odd">í™€ìˆ˜ (2ë°°)</button>
            <button class="special-btn" data-bet="low">1-22 (2ë°°)</button>
            <button class="special-btn" data-bet="high">23-45 (2ë°°)</button>
        </div>
        
        <div>
            <p>Selected bets: <span id="selectedCount">0</span></p>
            <p>Selected types: <span id="selectedTypes">None</span></p>
        </div>
        
        <button onclick="clearBets()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">Clear All Bets</button>
    </div>
    
    <div class="test-container">
        <h2>Automated Test Results</h2>
        <div id="testResults"></div>
        <button onclick="runAutomatedTests()" style="padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 5px; cursor: pointer;">Run Automated Tests</button>
    </div>

    <script>
        // Configuration from roulette system
        const ROULETTE_CONFIG = {
            bettingLimits: {
                maxSpecialBets: 2,
                maxNumberBets: 3
            },
            payoutRates: {
                numberBetMultiplier: 95,
                specialBetMultipliers: {
                    red: 2, black: 2, odd: 2, even: 2, high: 2, low: 2
                }
            }
        };
        
        let selectedBets = [];
        
        // Error message function from roulette.html
        function showErrorMessage(message) {
            let errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }
        
        // Special bet toggle function from roulette.html
        function toggleSpecialBet(betType) {
            const btn = document.querySelector(`[data-bet="${betType}"]`);
            const betIndex = selectedBets.findIndex(bet => bet.type === betType);
            
            if (betIndex >= 0) {
                // Remove existing bet
                selectedBets.splice(betIndex, 1);
                btn.classList.remove('selected');
            } else {
                // Validate special betting limit before adding new bet
                const specialBets = selectedBets.filter(bet => bet.type !== 'number');
                if (specialBets.length >= ROULETTE_CONFIG.bettingLimits.maxSpecialBets) {
                    // Show appropriate error message and maintain current selections
                    showErrorMessage(`íŠ¹ìˆ˜ ë² íŒ…ì€ ìµœëŒ€ ${ROULETTE_CONFIG.bettingLimits.maxSpecialBets}ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    return; // Prevent selection without adding the new bet
                }
                
                // Add new special bet
                selectedBets.push({ type: betType, payout: ROULETTE_CONFIG.payoutRates.specialBetMultipliers[betType] });
                btn.classList.add('selected');
            }
            
            updateDisplay();
        }
        
        function clearBets() {
            selectedBets = [];
            document.querySelectorAll('.selected').forEach(btn => btn.classList.remove('selected'));
            updateDisplay();
        }
        
        function updateDisplay() {
            const specialBets = selectedBets.filter(bet => bet.type !== 'number');
            document.getElementById('selectedCount').textContent = specialBets.length;
            document.getElementById('selectedTypes').textContent = 
                specialBets.length > 0 ? specialBets.map(bet => bet.type).join(', ') : 'None';
        }
        
        // Setup event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.special-btn').forEach(btn => {
                btn.onclick = () => toggleSpecialBet(btn.dataset.bet);
            });
        });
        
        // Automated test functions
        function runAutomatedTests() {
            const results = [];
            
            // Test 1: Allow maximum 2 special bets
            clearBets();
            toggleSpecialBet('red');
            toggleSpecialBet('odd');
            const specialBets1 = selectedBets.filter(bet => bet.type !== 'number');
            results.push({
                name: 'Requirement 1.1: Allow maximum 2 special bets',
                pass: specialBets1.length === 2,
                details: `Selected ${specialBets1.length} special bets (expected: 2)`
            });
            
            // Test 2: Prevent 3rd special bet
            const initialCount = selectedBets.length;
            toggleSpecialBet('high'); // This should be rejected
            const specialBets2 = selectedBets.filter(bet => bet.type !== 'number');
            results.push({
                name: 'Requirement 1.2: Prevent 3rd special bet selection',
                pass: specialBets2.length === 2 && selectedBets.length === initialCount,
                details: `Still have ${specialBets2.length} special bets after attempting to add 3rd (expected: 2)`
            });
            
            // Test 3: Maintain current selections
            const currentTypes = selectedBets.map(bet => bet.type);
            results.push({
                name: 'Requirement 1.4: Maintain current selections when limit exceeded',
                pass: currentTypes.includes('red') && currentTypes.includes('odd'),
                details: `Current selections: ${currentTypes.join(', ')}`
            });
            
            // Test 4: Allow selection after removal
            clearBets();
            toggleSpecialBet('black');
            toggleSpecialBet('even');
            toggleSpecialBet('black'); // Remove black
            toggleSpecialBet('low'); // Should be allowed
            const specialBets4 = selectedBets.filter(bet => bet.type !== 'number');
            results.push({
                name: 'Edge case: Allow selection after removal',
                pass: specialBets4.length === 2 && 
                      specialBets4.some(bet => bet.type === 'even') && 
                      specialBets4.some(bet => bet.type === 'low'),
                details: `Final selections: ${specialBets4.map(bet => bet.type).join(', ')}`
            });
            
            displayResults(results);
        }
        
        function displayResults(results) {
            const container = document.getElementById('testResults');
            container.innerHTML = '';
            
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.pass ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <strong>${result.pass ? 'âœ… PASS' : 'âŒ FAIL'}: ${result.name}</strong><br>
                    ${result.details}
                `;
                container.appendChild(div);
            });
            
            const summary = document.createElement('div');
            const passCount = results.filter(r => r.pass).length;
            summary.className = `test-result ${passCount === results.length ? 'pass' : 'fail'}`;
            summary.innerHTML = `<strong>Summary: ${passCount}/${results.length} tests passed</strong>`;
            container.appendChild(summary);
        }
    </script>
</body>
</html>